@using selfies.Models

@if (User.Identity.IsAuthenticated)
{

    <text>
        <p>
            inbox
        </p>

        <ul class="inbox">
            @if (ViewBag.threads.Count == 0)
            {
                <text><li>no threads yet, <a href="@Url.Content("~/send")">send one</a></li></text>
            } 

            @if (ViewBag.threads.Count > 0)
            {
                foreach (thread thready in ViewBag.threads)
                {
                    
                <text>
                    <li>


                            <div class="inboxImage">
                                @if(thready.authorizeRequest.Equals(1)) {
                                    <img src="@Url.Content("~/Images/lock.png")" />
                                } else {
                                    <img src="@Url.Content("~/api/snap/thumb/" + thready.groupKey)" />                                    
                                }
                            </div>

                            <div class="inboxText">
                                <a href="@Url.Content("~/threads/" + thready.groupKey)"> from: @thready.fromHandle.name, to @thready.toHandle.name</a>
                            </div>

                    </li>
                </text>
                }
            }

        </ul>

    </text>
            
}
else
{
 
    <text>

    <div id="welcome">

        <p>hey. authie is an easy way to send disappearing snaps and messages with your friends.</p>

        <ul>
            <li>no email required (or FB)</li>
            <li>iOS only</li>
        </ul>

        <p>just <a href="#">download</a> us on the appstore...</p>


    </div>

    </text>   
}

@section Scripts {
<script type="text/javascript">
    $(document).ready(function () {
        $("a.remover").click(function () {
            var currentId = $(this).attr('id');
            $("#li-" + currentId).fadeOut();

            $.ajax({
                url: "@Url.Content("~/api/thread")",
                data: { '': currentId },
                type: 'DELETE',
                success: function (result) {
                    // Do something with the result
                }
            });

        });
    });
</script>
}